PROJECT_NAME := cpu_stopwatch
SRCS := src/$(TARGET)/pins.cst $(wildcard src/$(TARGET)/*.sdc) $(wildcard src/$(TARGET)/*.sv) ../../external/picorv32/picorv32.v project.tcl src/sw/bootrom.hex
PMOD_PORT_OFFSET ?= 0

include ../build_gowin.mk

src/sw/bootrom.hex: src/sw/bootrom.c src/sw/link.ld src/sw/Makefile
	cd src/sw; make

ifeq ($(TARGET),tangnano9k_pmod)
src/$(TARGET)/pins.cst: src/$(TARGET)/pins.cst.template $(TARGET_DEF_DIR)/pmod_ports.csv $(MOD_DIR)/pmod_matrix_led/pmod_pins.csv $(MAPPMOD)
	echo // This file is automatically generated by build script. DO NOT EDIT THIS FILE. > $@
	cat src/$(TARGET)/pins.cst.template >> $@
	$(MAPPMOD) --pmod-port-def $(TARGET_DEF_DIR)/pmod_ports.csv --pmod $(MOD_DIR)/pmod_matrix_led/pmod_pins.csv --port-offset $(PMOD_PORT_OFFSET) --direction right-to-left >> $@
else
src/$(TARGET)/pins.cst:
	echo Use pre-generated pin definition.
endif